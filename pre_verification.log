============================= test session starts =============================
platform win32 -- Python 3.11.5, pytest-7.4.3, pluggy-1.6.0 -- C:\Users\Shamula\Documents\swe-hackathon-2026\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Shamula\Documents\swe-hackathon-2026\openlibrary_repo
configfile: pyproject.toml
plugins: anyio-4.12.1, asyncio-0.21.1, cov-4.1.0
asyncio: mode=Mode.STRICT
collecting ... collected 3 items

openlibrary/tests/core/test_imports.py::TestImportItem::test_find_staged_or_pending[unique_id_1-expected0] FAILED [ 33%]
openlibrary/tests/core/test_imports.py::TestImportItem::test_find_staged_or_pending[unique_id_2-expected1] FAILED [ 66%]
openlibrary/tests/core/test_imports.py::TestImportItem::test_find_staged_or_pending[unique_id_4-expected2] FAILED [100%]

================================== FAILURES ===================================
______ TestImportItem.test_find_staged_or_pending[unique_id_1-expected0] ______

self = <core.test_imports.TestImportItem object at 0x000001649C45B9D0>
import_item_db_staged_and_pending = <web.db.SqliteDB object at 0x000001649C1F9D50>
ia_id = 'unique_id_1', expected = [1, 3]

    @pytest.mark.parametrize(
        'ia_id, expected',
        [
            ('unique_id_1', [1, 3]),
            ('unique_id_2', [2]),
            ('unique_id_4', []),
        ],
    )
    def test_find_staged_or_pending(
        self, import_item_db_staged_and_pending, ia_id, expected
    ):
        """Get some staged and pending items by ia_id identifiers."""
>       items = ImportItem.find_staged_or_pending([ia_id], sources=["idb"])
E       AttributeError: type object 'ImportItem' has no attribute 'find_staged_or_pending'

openlibrary\tests\core\test_imports.py:163: AttributeError
---------------------------- Captured stderr setup ----------------------------
0.06 (1): 
CREATE TABLE import_item (
    id serial primary key,
    batch_id integer,
    status text default 'pending',
    error text,
    ia_id text,
    data text,
    ol_key text,
    comments text,
    UNIQUE (batch_id, ia_id)
);

0.0 (2): INSERT INTO import_item (batch_id, ia_id, id, status) VALUES (1, 'idb:unique_id_1', 1, 'pending')
0.0 (3): SELECT last_insert_rowid();
0.0 (4): INSERT INTO import_item (batch_id, ia_id, id, status) VALUES (1, 'idb:unique_id_2', 2, 'staged')
0.0 (5): SELECT last_insert_rowid();
0.0 (6): INSERT INTO import_item (batch_id, ia_id, id, status) VALUES (2, 'idb:unique_id_1', 3, 'staged')
0.0 (7): SELECT last_insert_rowid();
-------------------------- Captured stderr teardown ---------------------------
0.0 (8): delete from import_item;
______ TestImportItem.test_find_staged_or_pending[unique_id_2-expected1] ______

self = <core.test_imports.TestImportItem object at 0x000001649C459110>
import_item_db_staged_and_pending = <web.db.SqliteDB object at 0x000001649C1F9D50>
ia_id = 'unique_id_2', expected = [2]

    @pytest.mark.parametrize(
        'ia_id, expected',
        [
            ('unique_id_1', [1, 3]),
            ('unique_id_2', [2]),
            ('unique_id_4', []),
        ],
    )
    def test_find_staged_or_pending(
        self, import_item_db_staged_and_pending, ia_id, expected
    ):
        """Get some staged and pending items by ia_id identifiers."""
>       items = ImportItem.find_staged_or_pending([ia_id], sources=["idb"])
E       AttributeError: type object 'ImportItem' has no attribute 'find_staged_or_pending'

openlibrary\tests\core\test_imports.py:163: AttributeError
---------------------------- Captured stderr setup ----------------------------
0.0 (9): INSERT INTO import_item (batch_id, ia_id, id, status) VALUES (1, 'idb:unique_id_1', 1, 'pending')
0.0 (10): SELECT last_insert_rowid();
0.0 (11): INSERT INTO import_item (batch_id, ia_id, id, status) VALUES (1, 'idb:unique_id_2', 2, 'staged')
0.0 (12): SELECT last_insert_rowid();
0.0 (13): INSERT INTO import_item (batch_id, ia_id, id, status) VALUES (2, 'idb:unique_id_1', 3, 'staged')
0.0 (14): SELECT last_insert_rowid();
-------------------------- Captured stderr teardown ---------------------------
0.0 (15): delete from import_item;
______ TestImportItem.test_find_staged_or_pending[unique_id_4-expected2] ______

self = <core.test_imports.TestImportItem object at 0x000001649C45BCD0>
import_item_db_staged_and_pending = <web.db.SqliteDB object at 0x000001649C1F9D50>
ia_id = 'unique_id_4', expected = []

    @pytest.mark.parametrize(
        'ia_id, expected',
        [
            ('unique_id_1', [1, 3]),
            ('unique_id_2', [2]),
            ('unique_id_4', []),
        ],
    )
    def test_find_staged_or_pending(
        self, import_item_db_staged_and_pending, ia_id, expected
    ):
        """Get some staged and pending items by ia_id identifiers."""
>       items = ImportItem.find_staged_or_pending([ia_id], sources=["idb"])
E       AttributeError: type object 'ImportItem' has no attribute 'find_staged_or_pending'

openlibrary\tests\core\test_imports.py:163: AttributeError
---------------------------- Captured stderr setup ----------------------------
0.0 (16): INSERT INTO import_item (batch_id, ia_id, id, status) VALUES (1, 'idb:unique_id_1', 1, 'pending')
0.0 (17): SELECT last_insert_rowid();
0.0 (18): INSERT INTO import_item (batch_id, ia_id, id, status) VALUES (1, 'idb:unique_id_2', 2, 'staged')
0.0 (19): SELECT last_insert_rowid();
0.0 (20): INSERT INTO import_item (batch_id, ia_id, id, status) VALUES (2, 'idb:unique_id_1', 3, 'staged')
0.0 (21): SELECT last_insert_rowid();
-------------------------- Captured stderr teardown ---------------------------
0.0 (22): delete from import_item;
0.0 (23): delete from import_item;
============================== warnings summary ===============================
..\.venv\Lib\site-packages\web\webapi.py:6
  C:\Users\Shamula\Documents\swe-hackathon-2026\.venv\Lib\site-packages\web\webapi.py:6: DeprecationWarning: 'cgi' is deprecated and slated for removal in Python 3.13
    import cgi

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED openlibrary/tests/core/test_imports.py::TestImportItem::test_find_staged_or_pending[unique_id_1-expected0]
FAILED openlibrary/tests/core/test_imports.py::TestImportItem::test_find_staged_or_pending[unique_id_2-expected1]
FAILED openlibrary/tests/core/test_imports.py::TestImportItem::test_find_staged_or_pending[unique_id_4-expected2]
======================== 3 failed, 1 warning in 0.40s =========================
